In Windows a Portable Executable (PE) format is used for executable file like exe, dlls and other binary file types in he Windows os. It serves as the executable forma for 32-bit (PE32) and 64-bit (PE32+) systesms.

This is the structure of a PE file 
![[{B79DF5C7-ADA3-4F43-A76A-28A6B7C8DD99}.png]]



```text
+----------------------+
|      DOS Header      |    DOS compatibility structure (IMAGE_DOS_HEADER)
+----------------------+
|       DOS stub       |    Small DOS 2.0 compatible code printing "This program cannot be run in DOS mode"
+----------------------+
|     PE Signature     |    4-byte signature identifying the file as a PE file (PE\x00\x00)
+----------------------+
|      File Header     |    COFF file header. Example info: target machine, number of sections, 
|                      |    size of Optional header, etc. (IMAGE_FILE_HEADER)
+----------------------+
|   Optional Header    |    Example info: size of image, entry point, subsystem (GUI, console, etc.),
|                      |    OS version, etc. (IMAGE_OPTIONAL_HEADER)
+----------------------+
|   Data Directories   |    Array of structures holding extra info, ex. export/import tables, 
|                      |    digital certificates, exceptions, etc. (IMAGE_DATA_DIRECTORY)
+----------------------+
|   Section Headers    |    Array of metadata describing each section, ex. size in file and in memory,
|                      |    virtual address, no. of relocations, etc. (IMAGE_SECTION_HEADER)
+----------------------+
|                      |
|        .text         |    section containing executable code
|                      |
+----------------------+
|                      |
|        .data         |    section containing initialized data
|                      |
+----------------------+
|                      |
|       .idata         |    section containing import tables
|                      |
+----------------------+
|                      |
|        .rsrc         |    section containing resources (ex. icons, manifest, binary data, etc.)
|                      |
+----------------------+
```


## Key Windows API Structures
`IMAGE_DOS_HEADER` represents the DOS header of a PE file and is primarily used for compatibility reasons with older versions of Windows that used the MS-DOS executable format.

[**_IMAGE_NT_HEADERS_**](https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_nt_headers32) structure is primarily used to locate and interpret the different sections and headers within the PE file. It contains essential information about the PE file, such as its architecture, entry point, and various optional headers.
The `IMAGE_NT_HEADERS` is defined in the _winnt.h_ header file.

[**_IMAGE_FILE_HEADER_**](https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_file_header) structure contains generic information about the PE file.  
The `IMAGE_FILE_HEADER` is defined in the _winnt.h_ header file.

[**_IMAGE_OPTIONAL_HEADER_**](https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_optional_header32) structure provides crucial information to the loader. The name of the structure is misleading, as all image files are required to have it (although not all PE files do, ex. object files).
The `IMAGE_OPTIONAL_HEADER` is defined in the _winnt.h_ header file.

[**_IMAGE_DATA_DIRECTORY_**](https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_data_directory) structure holds information about the size and virtual address of specific data used by the system to initialize process, ex. imported DLLs and functions, used resources, digital certificates, etc.
The `IMAGE_DATA_DIRECTORY` structure is defined in the _winnt.h_ header file.

[**_IMAGE_SECTION_HEADER_**](https://learn.microsoft.com/en-us/windows/win32/api/winnt/ns-winnt-image_section_header) structure is used to represent a section in a PE (Portable Executable) file. The `IMAGE_SECTION_HEADER` structure is defined in the _winnt.h_ header file
